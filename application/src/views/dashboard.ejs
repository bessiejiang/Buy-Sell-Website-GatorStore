<% title = 'Dashboard'; jsFiles = []; cssFiles = ['/static/styles/dashboard.css']; %>

<%include ./partials/header.ejs%>
<%include ./partials/navbar.ejs%>

<center><h1>Dashboard</h1></center>
<hr>
<br>

<!-- TODO replace hardcoded pictures after login/signup implemented -->
<div class="container">
  <div class="center">
    <p><h3>Recently posted items:</h3></p>
    <div class="slideshow-container">

      <div class="mySlides slide-fade">
        <img src="static/img/ikea_sofa.jpg" alt="ikea sofa" style="width:220px;height:150px;">
        <img src="static/img/longboard.jpg" alt="longboard" style="width:90px;height:150px;">
        <img src="static/img/csc510tb.jpg" alt="csc510 textbook" style="width:210px;height:150px;">
      </div>

      <div class="mySlides slide-fade">
        <img src="static/img/longboard.jpg" alt="longboard" style="width:90px;height:150px;">
        <img src="static/img/csc510tb.jpg" alt="csc510 textbook" style="width:210px;height:150px;">
        <img src="static/img/ikea_sofa.jpg" alt="ikea sofa" style="width:220px;height:150px;">
      </div>

      <div class="mySlides slide-fade">
        <div class="numbertext"> </div>
        <img src="static/img/csc510tb.jpg" alt="csc510 textbook" style="width:210px;height:150px;">
        <div class="text"> </div>
      </div>

      <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
      <a class="next" onclick="plusSlides(1)">&#10095;</a>

    </div>
  </div>

  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="messages-tab" data-toggle="tab" href="#messages" role="tab" aria-controls="messages" aria-selected="true">Messages</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="items-tab" data-toggle="tab" href="#items" role="tab" aria-controls="items" aria-selected="false">Items</a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane show active" id="messages" role="tabpanel" aria-labelledby="messages-tab">
      <table class="table table-bordered">
        <thead class="thead-dark">
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Item</th>
            <th>Deal Location</th>
            <th>Deal time</th>
            <th>Message</th>
            <th>Created Time</th>
            <th>Reply</th>
          </tr>
        </thead>
        <% for (var i = 0; i < messages.length; i++) {%>
          <% message = messages[i];%>
          <tr>
            <td><%=message.from%></td>
            <td><%=message.to%></td>
            <td><%=message.item%></td>
            <td><%=message.dealLocation%></td>
            <td><%=message.dealTime%></td>
            <td><%=message.message%></td>
            <td><%=message.createdAt%></td>
            <!-- TODO: Only enable reply button for those messages sent to seller-->
            <td><button data-toggle="modal" data-target="#reply-modal-<%=i%>" class="btn btn-secondary">Reply</button></td>
          </tr>

          <!-- Contact Modal -->
          <div class="modal fade" id="reply-modal-<%=i%>" role="dialog">
            <div class="modal-dialog">
              <form action="/contact?item=<%=message.item%>" method="post">
                <!-- Contact Modal content-->
                <div class="modal-content row">
                  <div class="modal-header">
                    <h4 class="modal-title"><%=message.item%></h4>
                  </div>
                  <div class="modal-body row">
                    <!-- From and To are opposite for reply -->
                    <p class="col-md-10">From <input name="from" readonly type="text" value="<%=message.to%>"></p>
                    <p class="col-md-10">To <input name="to" readonly type="text" value="<%=message.from%>"></p>
                    <textarea name="contactDetails" class="item-description col-md-12" type="text" placeholder="type in details"></textarea>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Send</button>
                  </div>
                </div>
              </form>
            </div>
          </div>

        <%}%>
      </table>
    </div>

    <div class="tab-pane" id="items" role="tabpanel" aria-labelledby="items-tab">
      <table class="table table-bordered">
        <thead class="thead-dark">
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Price</th>
            <th>Description</th>
            <th>Photo</th>
            <th>Approval</th>
            <th></th>
          </tr>
        </thead>
        <% for (let item of items.rows) {%>
          <tr>
            <td><%=item.title%></td>
            <td><%=item.Category.name%></td>
            <td>$<%=item.price.toFixed(2)%></td>
            <td><%=item.description%></td>
            <td><img src="<%=item.photo%>" alt="<%=item.title%>" class="w-100"></td>
            <td class="text-center">
              <i class="h1 fa <%=
                item.approval == 'pending' ? 'fa-hourglass-half text-warning' :
                item.approval == 'approved' ? 'fa-check-circle text-success' :
                'fa-times-circle text-danger'
              %>" title="<%= item.approval %>" aria-hidden="true"></i>
            </td>
            <td><form action="/item/<%= item.id %>/delete" method="post"><button type="submit" class="btn btn-danger">Delete</button></form></td>
          </tr>
        <% } %>
        </table>
    </div>
  </div>
</div>

<script>
var slideIndex = 1;
showSlides(slideIndex);

function plusSlides(n) {
	showSlides(slideIndex += n);
}

function currentSlide(n) {
	showSlides(slideIndex = n);
}

function showSlides(n) {
	var i;
	var slides = document.getElementsByClassName("mySlides");
	// var dots = document.getElementsByClassName("dot");
	if (n > slides.length) {slideIndex = 1}
	if (n < 1) {slideIndex = slides.length}
	for (i = 0; i < slides.length; i++) {
			slides[i].style.display = "none";
	}
	// for (i = 0; i < dots.length; i++) {
	//     dots[i].className = dots[i].className.replace(" active", "");
	// }
	slides[slideIndex-1].style.display = "block";
	// dots[slideIndex-1].className += " active";
}
</script>

<%include ./partials/footer.ejs%>